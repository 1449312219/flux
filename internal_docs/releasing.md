# How to make a release of flux

This process will create a new tagged release of flux, push dockerfiles and upload the `fluxctl` binary to GitHub releases.

## Requirements
- Circle CI must have a secret environmental variable called `GITHUB_TOKEN` which is a personal access token.

## Release process

1. Alter and commit the /CHANGELOG.md file to signify what has changed in this version.
2. Ensure example deployment is up-to-date. (Check image tags)
3 Push that to a PR and have it reviewed.
  3.1 Merge!
4. Create a new release: https://github.com/weaveworks/flux/releases/new
5. Fill in the version number for the name and tag. The version number should conform to [semver](semver.org); i.e., look like `1.2.3` (NB: no leading 'v'); optionally with a pre-release suffix, e.g., `1.0.0-beta`
6. Fill in the Description field (possibly a copy paste from the CHANGELOG.md)
7. Click "Publish release"
8. Add a new release to https://checkpoint-api.weave.works/admin

Circle will then run the build and upload the built binaries to the "Downloads" section of the release.

## Outputs

The most recent binaries are always available at: https://github.com/weaveworks/flux/releases/latest

## Helm chart release process

1. Create a new branch as in `chart-bump`
2. Update `appVersion` with the new Flux version in `chart/flux/Chart.yaml`
3. Bump the chart version in `chart/flux/Chart.yaml`
4. Update `image.tag` with the new Flux version in `chart/flux/values.yaml`
5. For Flux Helm Operator update `helmOperator.tag` in `chart/flux/values.yaml`
6. Create a PR from `chart-bump`
7. After the PR is merged, tag the master with the chart version `git tag chart-0.2.2` and push it upstream
8. Checkout the `gh-pages` branch and run `./bin/update-chart.sh chart-0.2.2`, this will generate a new chart release package
9. Add all files generated by `update-chart.sh` and push those changes to `gh-pages`
